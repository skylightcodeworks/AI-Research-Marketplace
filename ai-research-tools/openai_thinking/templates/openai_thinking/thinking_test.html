<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>GPT-5.2 Extended Thinking Test</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
    <style>
        :root { --primary: #0d6efd; --thinking: #6f42c1; }
        body { background: #f8f9fa; min-height: 100vh; padding: 24px; }
        .card { border-radius: 12px; box-shadow: 0 2px 12px rgba(0,0,0,0.08); }
        .thinking-block { background: linear-gradient(135deg, #f3e8ff 0%, #e9d5ff 100%); border-left: 4px solid var(--thinking); padding: 16px; border-radius: 8px; white-space: pre-wrap; }
        .reply-block { background: #f0f9ff; border-left: 4px solid var(--primary); padding: 16px; border-radius: 8px; white-space: pre-wrap; }
        .badge-usage { font-size: 0.85rem; }
    </style>
</head>
<body>
    <div class="container-lg">
        <p class="text-end mb-0"><a href="{% url 'company_search' %}">Company Search</a> · <a href="{% url 'logout' %}">Log out</a></p>
        <h1 class="mb-2">GPT-5.2 Extended Thinking Test</h1>
        <p class="text-muted mb-4">Uses <code>OPEN_AI_API_KEY</code> from .env · Model: gpt-5.2 · Reasoning + optional Web Search</p>

        <div class="card mb-4 p-4">
            <form method="post" action="">
                {% csrf_token %}
                <div class="mb-3">
                    <label for="prompt" class="form-label fw-semibold">Prompt</label>
                    <textarea name="prompt" id="prompt" class="form-control" rows="4" placeholder="e.g. What was a positive news story from today? Or: Explain step-by-step how you would estimate the number of piano tuners in Chicago.">{{ prompt }}</textarea>
                </div>
                <div class="mb-3 d-flex flex-wrap align-items-center gap-3">
                    <div>
                        <label for="reasoning_effort" class="form-label fw-semibold">Reasoning effort</label>
                        <select name="reasoning_effort" id="reasoning_effort" class="form-select" style="max-width: 200px;">
                            <option value="low" {% if reasoning_effort == "low" %}selected{% endif %}>Low</option>
                            <option value="medium" {% if reasoning_effort == "medium" %}selected{% endif %}>Medium</option>
                            <option value="high" {% if reasoning_effort == "high" %}selected{% endif %}>High</option>
                            <option value="xhigh" {% if reasoning_effort == "xhigh" %}selected{% endif %}>xhigh (extended)</option>
                        </select>
                    </div>
                    <div class="form-check mt-4">
                        <input class="form-check-input" type="checkbox" name="use_web_search" id="use_web_search" {% if use_web_search %}checked{% endif %}>
                        <label class="form-check-label fw-semibold" for="use_web_search">Enable Web Search</label>
                        <div class="form-text">Let the model search the web for up-to-date info (Responses API)</div>
                    </div>
                </div>
                <button type="submit" class="btn btn-primary">Run with GPT-5.2</button>
            </form>
        </div>

        {% if error %}
        <div class="alert alert-danger">{{ error }}</div>
        {% endif %}

        {% if reply is not None %}
        <div class="card p-4">
            {% if reasoning %}
            <h5 class="text-purple mb-2">Reasoning (extended thinking)</h5>
            <div class="thinking-block mb-4">{{ reasoning }}</div>
            {% endif %}
            <h5 class="mb-2">Reply</h5>
            <div class="reply-block mb-3">{{ reply }}</div>
            {% if citations %}
            <h6 class="mb-2">Sources (web search)</h6>
            <ul class="list-unstyled small">
                {% for c in citations %}
                <li class="mb-1">
                    <a href="{{ c.url }}" target="_blank" rel="noopener">{{ c.title|default:c.url }}</a>
                    <span class="text-muted"> — {{ c.url }}</span>
                </li>
                {% endfor %}
            </ul>
            {% endif %}
            {% if usage %}
            <div class="badge-usage mt-2">
                <span class="badge bg-secondary">Prompt tokens: {{ usage.prompt_tokens }}</span>
                <span class="badge bg-secondary">Completion: {{ usage.completion_tokens }}</span>
                <span class="badge bg-secondary">Total: {{ usage.total_tokens }}</span>
            </div>
            {% endif %}
        </div>
        {% endif %}
    </div>
</body>
</html>
